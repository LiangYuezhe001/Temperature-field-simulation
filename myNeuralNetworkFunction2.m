function [Y,Xf,Af] = myNeuralNetworkFunction2(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 22-Feb-2023 00:59:31.
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = Qx7 matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = Qx7 matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [0;293.144849076321;378.920360263247;293.17428325308;293.176745303054;293.153340844143;500];
x1_step1.gain = [0.04;0.00439772283000273;0.00402194105125515;0.00639228745212392;0.00575213213162391;0.00916893551928536;0.01];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.9191649244750885739;-2.7086768013166366842;0.11928113280431887344;0.32583033370749509006;1.7106320623004418469;0.12310752551802681132;0.78008175521573752675;0.44568053115732841896;-0.51024231199350045252;-1.3611565508785341549;-1.5531905782919741554;-0.35654653370569433513;0.56468630081700532664;3.0986936982261736873];
IW1_1 = [0.64817689932081989923 -1.3016839760255922709 0.013179808529876779061 1.6663736821759780327 1.2891489843128878245 -3.3992441516023710335 0.37152507861169020709;-2.422983639894963126 -1.3825307962531143691 -6.1712866991009374118 -1.9391356668332246915 5.263488686449167453 0.29871095187171398111 1.731073617189800018;-0.43884965961984229166 -3.202362690961499947 2.738721355696311921 5.3780938384214724834 -4.2207693363034586298 0.2195441595109635935 0.2623702083331334034;0.0018424059907458517626 0.21363526961813253391 -0.30880279584454856101 -3.9177675487031544677 4.1089300274007651836 0.9559727601669686381 0.12408171481411746362;-2.821449384791667736 -2.0212195710884133248 -1.3084389729198675489 -0.54144683923070713316 0.94202388350440147136 -1.0033242773284460903 -0.684760779385916174;0.44808120563733172537 -0.32225106648350593241 -0.080835965100570866815 1.479205937461253173 -2.1865018520028396409 0.72990672047939819667 0.48829304615085028507;-1.4615239149854266643 -0.54336388060607709871 -0.24422310208299075063 -3.8986488325815851219 7.1187321287507083767 -3.6608556172161903497 0.29762665295707069202;1.2030317938358554564 0.27202676713084589233 -0.51469436267338941615 -0.30320504166467487916 1.6781121609335165612 0.13574860983883005328 1.1390256021712161782;0.66928195183719862982 0.12458697258627059179 0.43284195533166197611 3.3637050429862740408 -2.3141218308140021342 -1.8504797119855482812 0.30536138406343149576;-0.95862342286938528879 2.3396984115366001866 -1.1709931875877963581 2.7513760021290858404 -6.8538043416515321837 2.274239285382671838 0.40781616809121068457;-0.089558658317951636563 -0.59030482790633087564 0.75852153976637570754 0.90718904332788907752 2.8618671197927110228 -1.3894597596371924819 -0.04157842127242349084;-0.01645551551858424888 0.97501793337916231597 -0.45835296167934763689 0.34814560964325624859 -0.89239613528986516666 -1.1188387792625622552 -0.011245902527406580543;0.120726595570495851 0.71525144848822941324 -0.57912980743942843453 -0.49158537361790932696 -0.74030529971015501811 0.91569812133984240798 0.50278941560299161839;2.8560663889765942614 -1.2733718566542697737 0.31535233770614035098 2.0377638816695502477 -1.2959791812619192442 1.4118318228152295646 -0.07918261624190800485];

% Layer 2
b2 = [-2.2032982925219419812;-0.078667089639287271496;1.3501838836009605327;-0.053202593927350702585;0.14922243647530356037;0.065113250219169957478;0.052183749941270417272];
LW2_1 = [-0.039916949073025537187 -0.012454943448173314002 0.11152462327641830819 0.20377596270994635663 0.11003257738205794725 -0.053972067254583894202 -0.10983792868774730489 0.054418689397159755727 0.40878424911446842316 -1.8790695629179861026 -0.22286115172590637012 0.88771380272767452801 1.1660017107128510805 0.35022978574296631527;0.2074524317923884531 -0.04016513711342783316 0.42210005914092457724 0.54321324197658138466 0.21174687633101085815 0.005899838815573964397 0.1051672660359598277 -0.18947003810140761182 0.099378877392581818628 -0.3289754313884368786 0.29260913965391688318 -0.11533153380099170349 0.67044569913614049383 -0.7613851510406647316;0.20495376680708007888 0.005144783173303807064 -0.35501176621496394192 -0.2618185270361534922 0.16156423730623528656 0.26919003343021979946 0.081487138427090932691 -0.1251197830129337496 0.052621975522169003869 0.38733043241311965188 0.82583734560616384179 -1.1966069113220736408 0.14624303421531173464 -1.2857978593508365694;0.28866815147258328977 -0.056140475994820561445 0.47515989645514589146 0.76187386099453513477 0.20182498527050440895 0.088129825345325318864 0.20641547053560499458 -0.12315919900350066896 0.056381986017236832009 -0.27474765819660251776 0.24423281180872727369 0.20375189705498394921 0.46414964218633381066 -0.67687333827580320467;0.1658428651450740976 -0.017258701568815520283 0.22967562703553179304 0.22302667046067206624 0.20879843191044880624 0.027548922205183724171 0.092235098350853417237 -0.18505856648164470402 0.13002958182529678055 -0.23688580665992819974 0.40595374701436237608 -0.51529431236300471397 0.62866922157510951585 -0.88520565697699160612;0.20124880759552674081 -0.03297660070742787497 0.32040637943322886061 0.40019320133460006828 0.21274375384172822256 0.052707507995645302978 0.1350287995407901398 -0.17518536338227064242 0.13275832780574958747 -0.25759269994185296504 0.3445171554596022645 -0.29690737491025065431 0.57786525942879041207 -0.80736296745758062698;0.033753714710141498323 0.03496694658247066767 0.12354977137464998038 0.84833352631538916366 -0.14676280933451296695 1.010105715849131558 0.64165819884573460641 -0.063151884983992406797 0.70065066996440883429 -0.18638922668976859454 0.31863113324703340457 -0.047644737095685736616 0.77660720217890311101 -0.75589671932014135258];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [0.04;0.00339124915383859;0.00343265376238828;0.00337483483108877;0.00340561764119074;0.00339064219502096;0.01];
y1_step1.xoffset = [0;383.422134772947;390.510423420735;380.203339952262;385.88674279854;383.293566401332;500];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
    X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},1); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    X{1,ts} = X{1,ts}';
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);

    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);

    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;

    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
    Y{1,ts} = Y{1,ts}';
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
    Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
